# The Sovrin Protocol

The Sovrin Protocol is a set of standards, patterns, and tools that facilitate
trusted interactions. People, institutions, and things can use this
protocol to interact with one another in many different ways--but
always as peers, in patterns that are easy, powerful, secure, and private.

The protocol adapts to many different circumstances. It can be used on the
internet, over sneakernet, or even with snail mail.

The protocol is rooted in principles of Self-Sovereign Identity (SSI). Instead of
having powerful institutions grant marginalized people identities based
on siloed data, SSI puts identity owners in charge. They create their
own identity, manage keys, and share personal data however they want,
without constraints or approval from others. Nobody can take their identity
away.

## Safe and Empowered Digital Interactions

Alice wants to be able to interact with many different parties in different ways. 
First, she may want to act as a consumer, interacting with parties that she can obtain products or services from.
Secondly, she may want to act as a producer, and interact with parties that she can provide her services or products to.
A special case of the the latter is where Alice provides products called attestations or (verifiable) credentials, which are statements she wants to publish about a party or some thing (attributes).

Alice wants to be 'self sovereign' in the sense that she controls every of her interactions and other parties cannot interfere with them. 

Alice's digital interactions should be safe. Safe from prying eyes. Safe from services that track her without her knowledge and consent. Safe from unwanted correlation. Compromised third parties should not be able to impersonate her, or impersonate others to her. She should be safe from apps that exploit their positions of trust. Safe from disclosing more information about herself than is needed. 

Alice's digital interactions should be easy. Being secure should not be harder than not being secure. She shouldn't have to make a decision to be private; she should be private by default. She should have good information about the intent of interactions. Her apps should help her make good decisions about what to share and who to trust. 

Alice should be able to establish trust with another party with minimal reliance on third parties and minimal exchange of personal information. She should be able to make informed decisions about who is trustworthy. She should be able to share her reputation and attributes across contexts without revealing private information. Alice should have strong assurances in her digital interactions without the need for exchanging secrets and personal information.

Alice's digital interactions should be essentially free, regardless of her circumstances and regardless of where she lives in the world. The cost of interactions should not be an inhibitor to interaction. Alice should not feel compelled to give up privacy in exchange for the ability to interact digitally, or compelled to exchange her personal information for services.

For a more detailed discussion on these principles, see [Self-Sovereign Privacy By Design - V1](self_sovereign_privacy_by_design_v1.md).

## Three Dimensions of Self Sovereign Identity

There are three orthogonal dimensions to Alice's digital identity: (1) her _**relationships**_, (2) her _**knowledge**_ (which includes _**attributes**_), and (3) her _**agents**_. Separating these three dimensions allows for a clear understanding of how they interact. Conflating them confuses the proper role of actors and systems and weakens security.


### Relationships

A Sovrin relationship is a group of at least two parties, i.e. people and/or organizations. Things are excluded, as they are always owned by a party, and therefore are to be considered Agents (see further down).

A Sovrin relationship is represented by a set of two or more DIDs (Decentralized IDentifiers), each of which is generated by (or better: on behalf of) the party that it identifies. We say that the party owns the DIDs that it generates. (For more information, see the DID specification here: https://w3c-ccg.github.io/did-spec/).

In Sovrin, DIDs are not shared across relationships. In other words: if I am part of two relationships, I have generated a DID for each of them.
This helps protect privacy by limiting unwanted or cross-context correlation. Identifiers can be thought of as correlation handles. Correlation handles, like identifiers, are very useful within a context. Because each relationship, or "pairing," has a different identifier, you can say that Sovrin uses pairwise identifiers.

There are cases where a DID is well known, as in the case of a public corporation. A corporation can have one or more "public" DIDs. This holds true to the constraint that identifiers are not shared across contexts, because the context of these DIDs is a public one. This is an exceptional case. Even though a person is free to create a public DID, it is important not to attach to that DID a reputation that must be carried into other contexts.

### Knowledge

Sovrin recognizes that Alice has her own knowledge about the world she lives in. This knowledge is specific to Alice: Bob also has specific knowledge of the world he lives in. Bob's knowledge may or may not be the same, overlap, or even conflict with that of Alice.

Alice obtains her knowledge (learns) from her interactions with other parties and with the world itself. For example, when she meets Bob, who says he knows about a taxi driver called Dave, she has gained knowledge: she learned about the (alledged) existence of a person that she did not yet know about, and she learned some attributes: his name, and his profession. People learn a lot from information that others provide (hearsay).

Alice also learns from her own observations and experience. For example, when she listens to Carol sing in an opera, she will learn about her singing capabilities.

Alice's knowledge consists of (a) knowledge about entities (people, organizations, things) that exist, and (b) properties (observations/judgements/rumors/names/etc.) that she attributes to such entities. Alice uses 'identifiers', i.e. bitstrings that Alice chooses herself, to represent the entities she knows to exist. Alice uses her identifiers to distinguish between these entities. Alice uses 'attributes' to represent the observations, judgements, rumors, names, characteristics etc. that she attributes to an entity.

Alice's knowledge includes knowledge about herself. She uses the identifier 'I' to represent herself to herself, and as with any other identifier, she can attribute all sorts of observations/judgements/rumors to her 'I'. 

Sidenote: the identifier 'I' is used by many other (English speaking) people to refer to themselves. This shows that identifiers can only be dereferenced (i.e.: related to some entity) by the party  that 'owns' this identifier, i.e. in the context in which they belong. That explains an important privacy preserving property of DID-pairs/groups: the parties that have a DID in a DID group will know who the other party/parties in the group are. Parties that are not part of the group can only identify the party whose public DID is in the group. They have no clue as to which party to associate with a non-public DID.

One purpose for which Alice uses her knowledge is to make judgements and decisions. She does so by combining attributes of entities, using her own kind(s) of logic. The quality of such decisions depends on the quality of such logic(s), her proper understanding of the meaning of these attributes, and the truthfulness of the attribution. The higher the quality, the lower the risks associated with making incorrect decisions. This is obviously useful when interacting with others.

When Alice wanted a ride, she called Dave to see whether or not she would ask him to provide that ride. One of the things she wanted to make sure is that she would actually arrive at her destination in one piece. So, she needs assurance that Dave can drive safely. How does she come to reach this conclusion?

First, Alice decides that if a person has passed his driver test, he is capable of driving safely. Also, she decides to trust the department of motor vehicles (DMV) of any US state to have verified that the person they issue a driver license to, has actually passed its driver test. Finally, she decides that she is capable of determining whether or not the driver license is authentic. So, if Dave produces a driver license that is issued by the State of California, Alice can determine its authenticity, and conclude that she can safely ask him to provide the ride.

A party that asserts some attributes about others is called an **Issuer**. A **Credential** is a generic term to refer to a collection of attributes. The DMV of the State of California thus is an issuer of credentials called driver licenses. A credential allows its holder to prove to others what the issuer asserts about the holder.

### Agents

In the physical world, we can speak with our mouths, sign documents with our hands, hear with our ears. In the digital world, we have software and hardware that we use to accomplish the digital equivalent. These bits of running code that operate on our behalf in the digital world are called, Agents.

My mobile phone can run an agent. My notebook computer can run an agent. I can ask a service provider to host an agent in the cloud.

The important thing to note is that an agent represents one party. Even if an agent is hosted by a service provider, it still represents me. This means that every agent that represents me, must work with data (identifiers, attributes) that represent a part of my knowledge. If an agent receives data from an agent that represents someone else, such data will always be associated with the party that issued that data. This way, my agent can work with data from others without running the risk of messing up any decisions it takes.

Some agents have endpoints, which means that they can be contacted by other agents at any time. These agents can serve as simple message proxies or perform more sophisticated actions.

There are two types of agents: Edge Agents, and Cloud Agents. Edge Agents are Agents that the entity it represents usually has immediate control over, such as an agent that runs on a mobile phone or a notebook computer. Cloud Agents are Agents that the entity it represents usually does not have immediate control over, such as an agent that a service provider has agreed to host for me in the cloud.

<!--TODO: reconcile with description found elsewhere--> 

Agents hold keys which are authorized for certain types of activity. This allows the Agent owner to assign low privileges to lower trust Cloud Agents, and higher privileges to higher trust Edge Agents. Some privileges may require multiple keys held by different agents, including agents of trusted associates, to perform certain types of activities. For example, perhaps a funds transfer of greater than $10,000 USD would require two of four keys (phone, tablet, notebook, and Alice's partner, Bob).

My Agents are capable of accessing (digital representations of) my knowledge. This allows them to act on my behalf. In particular, it allows them to:

- help me act as a consumer, as I interact with parties from which I want to obtain certain products (or services). As my agent interacts with an agent of the product provider (e.g. a web-shop), it can present my knowledge (e.g. a name, a postal address etc.), as well as credentials (attestations) that are part of my knowledge (even though others have issued them). This helps the web-shop decide whether or not to accept my order. Conversely, my agent may 'know' that whenever it contacts an agent of another organization, it should require the web shop to provide a credential that proves it represents a real organization, e.g. by showing a credential issued by (an agent that represents) the chamber of commerce.
- help me to act as a service provider. Agents that have an endpoint can be contacted by other agents at any time, e.g. a web service that implements an online shop. My web-shop agent will need to access my knowledge about the products I sell, the price I charge, etc. A special case of me as a service provider is where I act in the role of Issuer. Whenever an agent contacts my 'issuer agent' (i.e. the agent that represents me in the digital domain in my function as Issuer), the latter must be capable of tapping into my knowledge about the entity that is the subject of the credential that I am asked to issue. Also, it will need to decide whether or not to provide this service (of issuing a credential for that entity), just as any other service providing agent would do. A common way to do this is to identify (and authenticate) the party that the requesting agent represents.


Reference diagrams found here: [DIDs, Credentials and Agents slides](https://docs.google.com/presentation/d/1oz1uB7y4J6GuqlmzyRmqrAwNiQQaWXs1LuHfFayAnwI) 

<!--TODO: pull diagrams into this doc.--> 

## The Intersections of Dimensions


### The Relationship-Knowledge Plane

Because Relationships and Knowledge are orthogonal, an Issuer does not issue credentials to a particular DID. Remember that the meaning of DIDs is limited to a relationship, and Credentials should be usable in different relationships without sharing correlation handles across relationships or contexts.

Rather, credentials should be issued in such a way that they can 'live in the knowledge' of a specific party, and that agents (e.g. web-shops) to which credentials are provided can ascertain that every credential has 'lived in the knowledge' of a single party; in other words: every such credential was issued to that specific party.

Sovrin Credentials cater for this by allowing for an agent (that represents a party) to dynamically generate proofs from one or more credentials as needed for any relationship, without correlation handles. This is not to say that cross-context correlation can't be done with shared attributes, but the control is in a person's hands, and the protocol does not leak correlation handles.


### The Relationship-Agent Plane

Because a person or entity has multiple relationships (represented by a pair of DIDs), an agent must support multiple DIDs. 

Not every agent needs to be used in every relationship. The Relationship-Agent plane is represented by a "Relationship State Machine," which is implemented with a replicated microledger. Agents are authorized within the microledger so the other party (or parties) in the relationship know how to regard each agent (identified by public key). For example, a cloud agent may _not_ be authorized to sign on behalf of a person, but may be authorized to communicate GPS coordinates or be a message relay.

<!--TODO: RSM reference above is probably too much detail for this section-->

Note, an agent does not have its own DID. DIDs are orthogonal to Agents. Agents can be identified by a local name, or by the public key used in a particular relationship. 

Each DID/Agent combination requires a separate key. An endpoint must be unique per relationship, so an agent must support multiple endpoints. 

Agents are authorized for certain types of activity _for each relationship_. This allows the Agent owner to use different agents in different contexts.


### The Agent-Attribute Plane

The keys Agents have are stored in their own wallets. Wallets can hold credentials (verifiable collections of attributes).

Agents have special keys that allow them to be able to generate proofs about credentials they hold. The Agent Authorization Policy is a combination of a ledger smart contract and a cryptographic accumulator that allows for proving in zero knowledge that a device is an authorized device. This allows a person or organization to have a sophisticated recovery policy and to be able to revoke a compromised agent.

A person may selectively copy credentials to different agents, effectively limiting which credentials are provable from which agents.

For more details about how these dimensions work together, see [How DIDs, Keys, Credentials, and Agents Work Together in Sovrin](https://docs.google.com/document/d/1hnQPEdfmAG-DnXGrDXowjc5J571pK7Ub4bWkUlzrH1Y).

## General Requirements

In order to achieve the conceptual model, we need the following:
1.  A Secure and private way to connect to and communicate with peers
1.  A privacy-respecting ability to assert things about others and prove assertions about oneself
1.  Control all her things (e.g., agent provisioning, authorization, revocation)
1.  Privacy respecting value transfer that is compliant with regulation
1.  Semantic Interoperability


### Secure peer-to-peer communications
In order for Alice to interact securely with others, she'll need a transport-agnostic protocol that encrypts all information and ensures authentication at every level. It should allow for multi-hop communications without needing to trust intermediaries or share more information than is minimally necessary to accomplish the task. [Janus](janus/README.md) is the working name for a protocol that meets these requirements. Janus uses pairwise [DIDs](did.md) as mentioned above. 

Alice also needs a way to bootstrap trust and ensure she's still interacting with who she thinks she is. The Sovrin network acts as a public registry for DIDs, public keys, and endpoints.

### Privacy-respecting issuing and proving

Alice needs a way to receive credentials from issuers. She also needs a way to prove that she holds a credential from a certain issuer with certain attributes or characteristics. She needs to do this in a way that doesn't share any more information than she intends. And her sharing of attributes should not result in disclosing correlation handles. [Themis](themis/README.md) is the working name for a protocol that accomplishes these requirements.

The Sovrin network acts as a public registry for Credential Definitions, Schema definitions, and Issuer public keys. Issuer public keys are used to verify proofs from credentials issued.

An issuer of a credential should also be able to revoke that credential. Alice should be able to prove she posesses a credential that is not revoked, without strongly identifying _which_ credential she holds. Privacy-respecting Revocation is a key to any credentialing system. 

The Sovrin network also acts as a public registry for Credential revocation.

### Control
Alice needs to be able to exercise control over her keys and agents without interference and without permission from a third party. * [DIDs and DID Documents](did.md) provide much of that functionality. The [Relationship State Machine](relationship-state-machine.md) is a concept that allows for pairwise relationships to be established securely without an initial write to Sovrin. Microledgers are an implementation of the the Relationship State Machine concept.

With Sovrin, reliance on a centralized third party is removed by design. This moves key management to the edge. It increases the responsibility of applications to properly manage keys and recovery. The [Decentralized Key Management (DKMS)](dkms/README.md) protocol outlines ways in which Alice can significantly reduce reliance on centralized third parties, while still being able to interact safely and securely.

Alice needs a way to provision new agents, and revoke them remotely if they are lost or compromised, and do this without communicating with them. Agent Authorization Policies, outlined in the DKMS documents, help to ensure only trusted devices are able to prove certain things on behalf of Alice. The Sovrin network is used to store a sophisticated agent provisioning policy along with a mechanism for proving in a privacy-respecting way that the agent used is authorized.


### Privacy-respecting value transfer
Alice needs to be able to send payment in interactions with others. For example, paying a fee for a Driver License. She needs a privacy respecting way to pay for transactions on the Sovrin ledger. Issuers need a way to recover some of the costs of issuing. Holders can pay Issuers, as in the case of Alice paying a fee for her driver license. Relying parties can also pay Issuers, as in the case of credit reporting agencies. All this should be done in a privacy respecting way.

<!--TODO: content needed.-->

### Semantic interoperability
Issuers and Relying Parties should not need to have strong agreements in place, or build expensive integrations. Sovrin [Schemas](themis/schema.md) are published on the Sovrin ledger by Sovrin users. Anyone can publish a schema.

Because they are public, others can see what kinds of attributes are being issued in credentials. Relying parties can adjust to those schemas, or suggest improvements to the Issuers.
 
Issuers can see what other issuers in their ecosystem are publishing and what relying parties are accepting. They can adjust to make it easier for relying parties to accept proofs of their credentials.

We believe there will be a natural and organic convergence around the most useful schemas.

<!--TODO: formalize the Sovrin type system.-->

<!--TODO: 

* Proof Request Proposal
  * [Concept: Schema Elements](https://docs.google.com/document/d/1VT8myB5XcCJIrIU2xEE3Vgxpfa47aFswh1qDCFCBtIg)
  * [Sovrin.org/schema](https://drive.google.com/open?id=130GRcmmLwDgCY9bgf9bYHarymkDLXO-R)

-->

<!--TODO: content needed: Must work for individuals and institutions alike.-->

<!--TODO: content needed: Using Sovrin as the Public Registry and the Public Ledger.-->

<!--TODO: directory of concepts mentioned above

## Key components of the Sovrin Protocol include:

* [Janus](janus/README.md) (a protocol for secure and private communication)
* [Themis](themis/README.md) (a subprotocol for issuing digital credentials and proving things with them in a privacy-preserving way)
* [Hermes](hermes/README.md) (a subprotocol for exchanging economic value)

-->

